<% layout('layouts/boilerplate') %>
<section class="media-intro">
    <div class="media-look">
        <div class="media-img">
            <img src="https://image.tmdb.org/t/p/w342<%= movie.poster_path %>">
        </div>
        <div class="media-ratings">
            <h3><span class="star">&#9733;</span><%= movie.vote_average %>/10</h3>
        </div>
    </div>
    <div class="media-info">
        <h1 class="media-title"><%= movie.title %> (<%= movie.release_date.slice(0, 4) %>)</h1>
        <p class="media-runtime-rating"><%= ageRating[0].certification %> | <%= movieRuntime[0] %> Hours
            <%= Math.round(movieRuntime.slice(1, movieRuntime.length) * 60)  %> Minutes</p>

        <p class="media-genres">
            <%= genres.join(', ') %>
        </p>
        <p class="media-summary"><%= movie.overview %></p>
        <div class="media-leads">
            <% for (let director of directors) {%>
            <p>
                Director: <%= director%>
            </p>
            <% } %>
            <p>
                <% if (writers.length > 1) {%>
                Writers:
                <% } else if (writers.length) {%>
                Writer:
                <% } %>
                <%= writers.join(', ')%>
            </p>
        </div>
        <div class="media-buttons-container">
            <button class="media-btn" id="watchlist">Add to Watchlist</button>
            <button class="media-btn" id="trailer">Watch Trailers</button>
        </div>
    </div>
</section>
<section class="media-cast">
    <h2 class="cast-title">The Cast</h2>
    <div class="media-cast-container">
        <% for (let actor of cast) { %>
        <div class="actor-card">
            <img class="actor-img"
                src="<%= actor.profile_path !== null ? `https://image.tmdb.org/t/p/w185${actor.profile_path}`: 'http://res.cloudinary.com/dfuxr1p10/image/upload/c_fill,h_278,w_185/v1630626598/CInemaBuff/placeholder-image-person-jpg_qa9zba.jpg'%>">
            <div class="actor-card-body">
                <h4><%= actor.name %></h4>
                <p><%= actor.character %> </p>
            </div>
        </div>
        <% } %>
    </div>
</section>
<section class="media-video">
    <h2>Videos</h2>
    <div class="media-video-container">
        <video id="my-player" class="video-js vjs-theme-sea" controls preload="auto" data-setup='{}'>
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a
                web browser that
            </p>
        </video>
        <div class="vjs-playlist"></div>
        <span id="yy" style="display:none">
            <%= JSON.stringify(videos); %>
        </span>
    </div>
</section>
<script>
    const videos = JSON.parse(document.getElementById("yy").innerText);
    const player = videojs('my-player');
    const myPlaylist = [];
    for (let video of videos) {
        myPlaylist.push({
            name: video.name,
            sources: [{
                src: `https://www.youtube.com/watch?v=${ video.key }`,
                type: 'video/youtube'
            }],
            poster: `https://img.youtube.com/vi/${ video.key }/maxresdefault.jpg`,
            thumbnail: [
                {
                    srcset: `https://img.youtube.com/vi/${ video.key }/maxresdefault.jpg`,
                    type: 'image/jpeg',
                    media: '(min-width: 400px)'
                }
            ]
        });
    }
    player.playlist(myPlaylist)
    player.playlistUi({ horizontal: true });
    videojs(document.querySelector('video')).playlistUi();
</script>